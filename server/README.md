# ParentPilot.AI Backend

A comprehensive backend system for ParentPilot.AI, featuring a sophisticated sub-agent architecture for personalized parenting assistance.

## ğŸ—ï¸ Architecture Overview

### Core Components

1. **Express.js Server** - Main API server with RESTful endpoints
2. **Supabase Integration** - Database and authentication
3. **Sub-Agent System** - Specialized AI agents for different parenting domains
4. **AI Integration** - Claude API for intelligent responses
5. **TypeScript** - Full type safety throughout the application

### Sub-Agent System

The backend implements a sophisticated sub-agent architecture where specialized AI agents handle different aspects of parenting:

- **Development Tracker** - Monitors developmental milestones and progress
- **Learning Coach** - Provides personalized learning strategies and activities
- **Behavior Analyst** - Analyzes behavior patterns and provides insights
- **Social Skills Mentor** - Focuses on social and emotional development
- **Academic Advisor** - Provides academic guidance and educational planning
- **Health Monitor** - Tracks health-related milestones and wellness
- **Creative Catalyst** - Encourages creativity and artistic development
- **Technology Guide** - Manages screen time and digital learning

## ğŸš€ Quick Start

### Prerequisites

- Node.js 18+ 
- Supabase account
- Claude API key

### Installation

1. **Clone and install dependencies:**
   ```bash
   cd server
   npm install
   ```

2. **Set up environment variables:**
   ```bash
   # Option 1: Use the setup script
   npm run setup:env
   
   # Option 2: Copy manually
   cp env.example .env
   
   # Edit .env with your actual values
   # See ENVIRONMENT.md for detailed configuration
   ```

3. **Set up Supabase database:**
   ```bash
   # Run the schema.sql file in your Supabase SQL editor
   # This creates all necessary tables and indexes
   ```

4. **Validate environment configuration:**
   ```bash
   npm run validate:env
   ```

5. **Start the development server:**
   ```bash
   npm run dev
   ```

## ğŸ“Š Database Schema

### Core Tables

- **users** - User accounts and subscription information
- **children** - Child profiles with interests, strengths, and learning styles
- **plans** - Development roadmaps and educational plans
- **chat_history** - Conversation history for AI interactions
- **weekly_digests** - Weekly progress summaries
- **enrichment_activities** - Personalized learning activities
- **milestones** - Developmental milestones tracking
- **activity_logs** - Activity tracking and logging

### Sub-Agent Tables

- **agent_types** - Available agent types and capabilities
- **sub_agents** - User-specific agent instances
- **agent_conversations** - Agent-specific conversation history
- **agent_tasks** - Tasks assigned to specific agents
- **agent_insights** - Insights generated by agents
- **agent_recommendations** - Recommendations from agents
- **agent_learning_data** - Learning data for agent improvement

## ğŸ”Œ API Endpoints

### Core Endpoints

```
GET    /api/ping                    # Health check
GET    /api/demo                    # Demo endpoint
POST   /api/generate-dream-plan     # Generate development roadmap
POST   /api/generate-weekly-digest  # Generate weekly digest
POST   /api/recommend-enrichment    # Generate enrichment recommendations
POST   /api/chat                    # Main AI chat assistant
```

### Sub-Agent Endpoints

#### Agent Management
```
GET    /api/agents/types                    # Get available agent types
GET    /api/users/:userId/agents            # Get user's agents
POST   /api/agents                         # Create new sub-agent
PUT    /api/agents/:agentId                # Update sub-agent
```

#### Agent Messaging
```
POST   /api/agents/:agentId/message        # Send message to specific agent
POST   /api/agents/route-message           # Route message to best agent
```

#### Agent Insights & Recommendations
```
POST   /api/agents/:agentId/insights       # Generate agent insights
POST   /api/agents/:agentId/recommendations # Generate agent recommendations
GET    /api/agents/:agentId/insights       # Get agent insights
GET    /api/agents/:agentId/recommendations # Get agent recommendations
```

#### Agent Tasks
```
GET    /api/agents/:agentId/tasks          # Get agent tasks
POST   /api/agents/:agentId/tasks          # Create agent task
PUT    /api/agents/:agentId/tasks/:taskId  # Update agent task
POST   /api/agents/:agentId/tasks/:taskId/execute # Execute agent task
```

#### Agent Conversations
```
GET    /api/agents/:agentId/conversations  # Get agent conversations
```

## ğŸ¤– Sub-Agent System

### Agent Types

Each agent type specializes in different aspects of parenting:

1. **Development Tracker**
   - Tracks developmental milestones
   - Analyzes progress patterns
   - Identifies potential delays
   - Provides developmental guidance

2. **Learning Coach**
   - Personalizes learning strategies
   - Recommends educational activities
   - Assesses learning skills
   - Optimizes learning environments

3. **Behavior Analyst**
   - Analyzes behavior patterns
   - Identifies triggers and responses
   - Suggests intervention strategies
   - Tracks behavior changes

4. **Social Skills Mentor**
   - Focuses on social development
   - Enhances emotional intelligence
   - Improves peer interactions
   - Builds communication skills

5. **Academic Advisor**
   - Provides academic guidance
   - Plans educational curriculum
   - Tracks academic performance
   - Suggests learning resources

6. **Health Monitor**
   - Tracks health milestones
   - Monitors nutrition and wellness
   - Provides health recommendations
   - Alerts for health concerns

7. **Creative Catalyst**
   - Encourages artistic expression
   - Stimulates imagination
   - Provides creative activities
   - Builds artistic skills

8. **Technology Guide**
   - Manages screen time
   - Recommends digital learning
   - Ensures tech balance
   - Provides digital safety guidance

### Agent Capabilities

Each agent has specific capabilities:

- **Message Processing** - Handle user queries and provide responses
- **Insight Generation** - Analyze data and generate insights
- **Recommendation Creation** - Provide actionable recommendations
- **Task Execution** - Perform specific tasks and assessments
- **Learning** - Improve based on interactions and feedback

## ğŸ”§ Configuration

### Environment Variables

Required:
- `SUPABASE_URL` - Your Supabase project URL
- `SUPABASE_SERVICE_ROLE_KEY` - Supabase service role key
- `CLAUDE_API_KEY` - Anthropic Claude API key

Optional:
- `PORT` - Server port (default: 3001)
- `NODE_ENV` - Environment (development/production)
- Additional AI service keys
- Monitoring and analytics keys
- Email service configuration
- File storage configuration

### Database Setup

1. Create a Supabase project
2. Run the schema.sql file in the Supabase SQL editor
3. Configure Row Level Security (RLS) policies
4. Set up authentication if needed

## ğŸ§ª Testing

```bash
# Run tests
npm test

# Run tests with coverage
npm run test:coverage

# Run specific test file
npm test -- --grep "agent"
```

## ğŸ“¦ Deployment

### Development
```bash
npm run dev
```

### Production Build
```bash
npm run build
npm start
```

### Docker Deployment
```bash
docker build -t parentpilot-backend .
docker run -p 3001:3001 parentpilot-backend
```

## ğŸ”’ Security

- All endpoints validate input data
- Row Level Security (RLS) enabled on all tables
- Environment variables for sensitive data
- Rate limiting on API endpoints
- CORS configuration for frontend integration

## ğŸ“ˆ Monitoring

- Health check endpoint: `/api/ping`
- Database connection monitoring
- Agent performance tracking
- Error logging and alerting

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests for new functionality
5. Submit a pull request

## ğŸ“ License

This project is licensed under the MIT License.

## ğŸ†˜ Support

For support and questions:
- Create an issue in the repository
- Check the documentation
- Review the API examples

## ğŸ”„ Updates

The backend system is designed to be extensible. New agent types can be added by:

1. Creating a new agent class extending `BaseAgent`
2. Adding the agent type to the database
3. Updating the agent factory
4. Adding corresponding API endpoints

This modular design allows for easy expansion and customization of the parenting assistance system. 